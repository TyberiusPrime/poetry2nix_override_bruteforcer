{"info":{"author":"Trevor Gale","author_email":"tgale@stanford.edu","bugtrack_url":null,"classifiers":["License :: OSI Approved :: BSD License","Operating System :: Unix","Programming Language :: Python :: 3"],"description":"# :robot: MegaBlocks\n\nMegaBlocks is a light-weight library for mixture-of-experts (MoE) training. The core of the system is efficient \"dropless-MoE\" ([dMoE](megablocks/layers/dmoe.py), [paper](https://arxiv.org/abs/2211.15841)) and standard [MoE](megablocks/layers/moe.py) layers.\n\nMegaBlocks is built on top of [Megatron-LM](https://github.com/NVIDIA/Megatron-LM), where we support data, expert and pipeline parallel training of MoEs. We're working on extending more frameworks to support MegaBlocks.\n\n# :rocket: Performance\n\n![MegaBlocks Performance](media/dropping_end_to_end.png)\n\nMegaBlocks dMoEs outperform MoEs trained with [Tutel](https://github.com/microsoft/tutel) by up to **40%** compared to Tutel's best performing `capacity_factor` configuration. MegaBlocks dMoEs use a reformulation of MoEs in terms of block-sparse operations, which allows us to avoid token dropping without sacrificing hardware efficiency. In addition to being faster, MegaBlocks simplifies MoE training by removing the `capacity_factor` hyperparameter altogether. Compared to dense Transformers trained with [Megatron-LM](https://github.com/NVIDIA/Megatron-LM), MegaBlocks dMoEs can accelerate training by as much as **2.4x**. Check out our [paper](https://arxiv.org/abs/2211.15841) for more details!\n\n# :building_construction: Installation\n\nNOTE: This assumes you have `numpy` and `torch` installed.\n\n**Training models with Megatron-LM:** We recommend using NGC's [`nvcr.io/nvidia/pytorch:23.09-py3`](https://catalog.ngc.nvidia.com/orgs/nvidia/containers/pytorch/tags) PyTorch container. The [Dockerfile](Dockerfile) builds on this image with additional dependencies. To build the image, run `docker build . -t megablocks-dev` and then `bash docker.sh` to launch the container. Once inside the container, install MegaBlocks with `pip install .`. See [Usage](#steam_locomotive-usage) for instructions on training MoEs with MegaBlocks + Megatron-LM.\n\n**Using MegaBlocks in other packages:** To install the MegaBlocks package for use in other frameworks, run `pip install megablocks`. For example, [Mixtral-8x7B](https://mistral.ai/news/mixtral-of-experts/) can be run with [vLLM](https://github.com/vllm-project/vllm) + MegaBlocks with this installation method.\n\n**Extras:** MegaBlocks has optional dependencies that enable additional features.\n\nInstalling `megablocks[quant]` enables configurable quantization of saved activations in the dMoE layer to save memory during training. The degree of quantization is controlled via the `quantize_inputs_num_bits`, `quantize_rematerialize_num_bits` and `quantize_scatter_num_bits` [arguments](https://github.com/stanford-futuredata/megablocks/blob/main/megablocks/layers/arguments.py).\n\nInstalling `megablocks[gg]` enables dMoE computation with grouped GEMM. This feature is enabled by setting the `mlp_impl` argument to `grouped`. This is currently our recommended path for Hopper-generation GPUs.\n\nMegaBlocks can be installed with all dependencies via the `megablocks[all]` package.\n\n# :steam_locomotive: Usage\n\nWe provide scripts for pre-training Transformer MoE and dMoE language models under the [top-level directory](megablocks/). The quickest way to get started is to use one of the [experiment launch scripts](exp/). These scripts require a dataset in Megatron-LM's format, which can be created by following their [instructions](https://github.com/NVIDIA/Megatron-LM#data-preprocessing).\n\n# :writing_hand: Citation\n\n```\n@article{megablocks,\n  title={{MegaBlocks: Efficient Sparse Training with Mixture-of-Experts}},\n  author={Trevor Gale and Deepak Narayanan and Cliff Young and Matei Zaharia},\n  journal={Proceedings of Machine Learning and Systems},\n  volume={5},\n  year={2023}\n}\n```\n","description_content_type":"text/markdown","docs_url":null,"download_url":"","downloads":{"last_day":-1,"last_month":-1,"last_week":-1},"dynamic":null,"home_page":"https://github.com/stanford-futuredata/megablocks","keywords":"","license":"","maintainer":"","maintainer_email":"","name":"megablocks","package_url":"https://pypi.org/project/megablocks/","platform":null,"project_url":"https://pypi.org/project/megablocks/","project_urls":{"Homepage":"https://github.com/stanford-futuredata/megablocks"},"provides_extra":null,"release_url":"https://pypi.org/project/megablocks/0.5.1/","requires_dist":["triton>=2.1.0","stanford-stk>=0.0.6","grouped_gemm; extra == \"gg\"","mosaicml-turbo==0.0.4; extra == \"quant\"","absl-py; extra == \"dev\"","mosaicml-turbo==0.0.4; extra == \"all\"","absl-py; extra == \"all\"","grouped_gemm; extra == \"all\""],"requires_python":"","summary":"MegaBlocks","version":"0.5.1","yanked":false,"yanked_reason":null},"last_serial":22689028,"releases":{"0.0.1":[{"comment_text":"","digests":{"blake2b_256":"740c63c27013e40d69fe39ca52adb37f9ffb7ab5f831015635f7a8b56e273499","md5":"66344339cc2afb7b7a1fb6501e935f0d","sha256":"cd5fdec8d255915502ea38ecbe3826f58e9a099b708f95e1484963b2a0c35e4c"},"downloads":-1,"filename":"megablocks-0.0.1.tar.gz","has_sig":false,"md5_digest":"66344339cc2afb7b7a1fb6501e935f0d","packagetype":"sdist","python_version":"source","requires_python":null,"size":35073,"upload_time":"2023-02-16T05:10:54","upload_time_iso_8601":"2023-02-16T05:10:54.639805Z","url":"https://files.pythonhosted.org/packages/74/0c/63c27013e40d69fe39ca52adb37f9ffb7ab5f831015635f7a8b56e273499/megablocks-0.0.1.tar.gz","yanked":false,"yanked_reason":null}],"0.0.2":[{"comment_text":"","digests":{"blake2b_256":"7c13125d79cfb4c339619c20b41ee80d37a3dd46cd3d8ebc0b27f087d2f8ed74","md5":"066d327fb80fa9aa929c836da90485dc","sha256":"cd582d879f467f263918eda780605ff20d993bc079939bee1cfe12d2e437e07c"},"downloads":-1,"filename":"megablocks-0.0.2.tar.gz","has_sig":false,"md5_digest":"066d327fb80fa9aa929c836da90485dc","packagetype":"sdist","python_version":"source","requires_python":null,"size":33346,"upload_time":"2023-02-20T17:20:38","upload_time_iso_8601":"2023-02-20T17:20:38.389136Z","url":"https://files.pythonhosted.org/packages/7c/13/125d79cfb4c339619c20b41ee80d37a3dd46cd3d8ebc0b27f087d2f8ed74/megablocks-0.0.2.tar.gz","yanked":false,"yanked_reason":null}],"0.5.0":[{"comment_text":"","digests":{"blake2b_256":"64a77db988e6e193d2e5988a2d204334b408c7db2a07e9d3b847de570b90b2f1","md5":"a5351149881044ead3f49a1d6af32150","sha256":"763bba778f6fd45b1d949df6568bebd67ccf40bac5993a2bca3b120e2ae6a610"},"downloads":-1,"filename":"megablocks-0.5.0.tar.gz","has_sig":false,"md5_digest":"a5351149881044ead3f49a1d6af32150","packagetype":"sdist","python_version":"source","requires_python":null,"size":47706,"upload_time":"2023-12-11T17:39:00","upload_time_iso_8601":"2023-12-11T17:39:00.094663Z","url":"https://files.pythonhosted.org/packages/64/a7/7db988e6e193d2e5988a2d204334b408c7db2a07e9d3b847de570b90b2f1/megablocks-0.5.0.tar.gz","yanked":false,"yanked_reason":null}],"0.5.1":[{"comment_text":"","digests":{"blake2b_256":"f5a32f5d86db5e41a53f5e0dcf1b9cd0b1e7be1c09f16496d1d05220270a5b34","md5":"36035aacd29c1a9807e6a86c4cec2bb8","sha256":"4e3346f2987761e67055a8947e9ee97f9673c672056d61c89f060546f448277c"},"downloads":-1,"filename":"megablocks-0.5.1.tar.gz","has_sig":false,"md5_digest":"36035aacd29c1a9807e6a86c4cec2bb8","packagetype":"sdist","python_version":"source","requires_python":null,"size":49189,"upload_time":"2024-01-11T22:15:48","upload_time_iso_8601":"2024-01-11T22:15:48.575506Z","url":"https://files.pythonhosted.org/packages/f5/a3/2f5d86db5e41a53f5e0dcf1b9cd0b1e7be1c09f16496d1d05220270a5b34/megablocks-0.5.1.tar.gz","yanked":false,"yanked_reason":null}]},"urls":[{"comment_text":"","digests":{"blake2b_256":"f5a32f5d86db5e41a53f5e0dcf1b9cd0b1e7be1c09f16496d1d05220270a5b34","md5":"36035aacd29c1a9807e6a86c4cec2bb8","sha256":"4e3346f2987761e67055a8947e9ee97f9673c672056d61c89f060546f448277c"},"downloads":-1,"filename":"megablocks-0.5.1.tar.gz","has_sig":false,"md5_digest":"36035aacd29c1a9807e6a86c4cec2bb8","packagetype":"sdist","python_version":"source","requires_python":null,"size":49189,"upload_time":"2024-01-11T22:15:48","upload_time_iso_8601":"2024-01-11T22:15:48.575506Z","url":"https://files.pythonhosted.org/packages/f5/a3/2f5d86db5e41a53f5e0dcf1b9cd0b1e7be1c09f16496d1d05220270a5b34/megablocks-0.5.1.tar.gz","yanked":false,"yanked_reason":null}],"vulnerabilities":[]}
